# éº»é›€ã‚²ãƒ¼ãƒ  ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆæœ€å°é™å®Ÿè£…ï¼‰

3äººéº»é›€ã‚²ãƒ¼ãƒ ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã€‚**ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**ã¨**WebSocketæ¥ç¶šç¢ºèª**ã€**åˆå›é…ç‰Œ**ã®ã¿ã®æœ€å°é™å®Ÿè£…ã€‚

## ğŸ¯ å®Ÿè£…æ©Ÿèƒ½

âœ… **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯** (`/health`)
- ã‚µãƒ¼ãƒãƒ¼ç¨¼åƒçŠ¶æ³ç¢ºèª

âœ… **WebSocketæ¥ç¶šç¢ºèª** (`/ws/game`)
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šç¢ºèª
- æ¥ç¶šå¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

âœ… **åˆå›é…ç‰Œ**
- 3äººæ¥ç¶šæ™‚ã«è‡ªå‹•é…ç‰Œ
- å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«13æšãšã¤é…å¸ƒ
- ç‹ç‰Œãƒ»å±±ç‰Œã®è¨­å®š

## ğŸš€ å®Ÿè¡Œæ–¹æ³•

### å‰ææ¡ä»¶
- Go 1.21ä»¥ä¸Š
- Dockerï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### æ–¹æ³•1: ç›´æ¥å®Ÿè¡Œ

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd backend

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
go mod tidy

make run
```

## ğŸ§ª å‹•ä½œç¢ºèª

### 1. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```bash
curl http://localhost:8080/health
```

**æœŸå¾…ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "status": "ok",
  "service": "mahjong-backend",
  "version": "1.0.0"
}
```

### 2. Swagger UI

ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹:
```
http://localhost:8080/swagger/index.html
```

### 3. WebSocketæ¥ç¶šãƒ†ã‚¹ãƒˆ

#### websocat ã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

```bash
# websocatã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆï¼‰
# macOS
brew install websocat

# æŒç¶šçš„ãªæ¥ç¶šï¼ˆå¯¾è©±å½¢å¼ï¼‰
websocat ws://localhost:8080/ws/game
# æ¥ç¶šå¾Œã€ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¦Enter:
{"type":"connection_check","data":{"playerId":"p3"}}
```

**æœŸå¾…ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "type": "connection_response",
  "data": {
    "playerId": "test-player-1",
    "playersCount": 1,
    "maxPlayers": 3,
    "status": "waiting",
    "message": "æ¥ç¶šç¢ºèªå®Œäº†"
  }
}
```

#### ãã®ä»–ã®WebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

WebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ `ws://localhost:8080/ws/game` ã«æ¥ç¶šå¾Œã€ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡:

```json
{
  "type": "connection_check",
  "data": {
    "playerId": "test-player-1"
  }
}
```

### 4. 3äººæ¥ç¶šã§ã®é…ç‰Œãƒ†ã‚¹ãƒˆ

#### websocatä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

3ã¤ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ã¦ã€ãã‚Œãã‚Œã§æŒç¶šçš„ãªæ¥ç¶šã‚’è¡Œã„ã¾ã™ï¼š

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1:**
```bash
websocat ws://localhost:8080/ws/game
# æ¥ç¶šå¾Œã€ä»¥ä¸‹ã‚’å…¥åŠ›:
{"type":"connection_check","data":{"playerId":"p1"}}
```

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2:**
```bash
websocat ws://localhost:8080/ws/game
# æ¥ç¶šå¾Œã€ä»¥ä¸‹ã‚’å…¥åŠ›:
{"type":"connection_check","data":{"playerId":"p2"}}
```

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3:**
```bash
websocat ws://localhost:8080/ws/game
# æ¥ç¶šå¾Œã€ä»¥ä¸‹ã‚’å…¥åŠ›:
{"type":"connection_check","data":{"playerId":"p3"}}
```


3äººç›®ãŒæ¥ç¶šã™ã‚‹ã¨ã€å„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ä»¥ä¸‹ã®ã‚ˆã†ãªé…ç‰Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã¾ã™:

```json
{
  "type": "game_start",
  "data": {
    "gameId": "ã‚²ãƒ¼ãƒ ID",
    "playerId": "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ID",
    "tehai": ["1m","2m","3m",...],
    "wanpai": {
      "revealedDora": ["hatu"],
      "kanDoras": ["4s","7s","9s"],
      "unrevealedDoras": ["4p","nan","1m","9s"],
      "rinsyan": ["5pr","chun","6p","7p"]
    },
    "yama": [...],
    "players": [
      {"id": "p1", "tehai": [...], "isHost": true},
      {"id": "p2", "tehai": [...], "isHost": false},
      {"id": "p3", "tehai": [...], "isHost": false}
    ]
  }
}
```

## ï¿½ WebSocketæ¥ç¶šã«ã¤ã„ã¦

**é‡è¦ãªæ³¨æ„ç‚¹:**
- `echo | websocat` ã‚’ä½¿ã†ã¨ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å¾Œã™ãã«æ¥ç¶šãŒé–‰ã˜ã¾ã™
- 3äººéº»é›€ã®ãƒ†ã‚¹ãƒˆã«ã¯ **æŒç¶šçš„ãªæ¥ç¶š** ãŒå¿…è¦ã§ã™
- é…ç‰Œã‚’å—ä¿¡ã™ã‚‹ã«ã¯ã€3äººå…¨å“¡ãŒ **åŒæ™‚ã«æ¥ç¶šçŠ¶æ…‹** ã‚’ä¿ã¤å¿…è¦ãŒã‚ã‚Šã¾ã™

**æ¨å¥¨ãƒ†ã‚¹ãƒˆæ–¹æ³•:**
1. `websocat ws://localhost:8080/ws/game` ã§å¯¾è©±å½¢å¼æ¥ç¶š
2. Node.jsã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ`test-websocket.js`ï¼‰ã§ã®æŒç¶šçš„æ¥ç¶š
3. 3ã¤ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§åŒæ™‚æ¥ç¶šãƒ†ã‚¹ãƒˆ

## ï¿½ğŸ› ï¸ é–‹ç™º

### åˆ©ç”¨å¯èƒ½ãªMakeã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ“ãƒ«ãƒ‰
make build

# èµ·å‹•
make run

# ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰èµ·å‹•ï¼ˆè¦airï¼‰
make dev

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make test

# ãƒªãƒ³ãƒˆå®Ÿè¡Œ
make lint

# Swaggeræ–‡æ›¸ç”Ÿæˆ
make swagger-gen

# Dockeré–¢é€£
make docker-build    # ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
make docker-up       # èµ·å‹•
make docker-down     # åœæ­¢

# ãƒ˜ãƒ«ãƒ—
make help
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
backend/
â”œâ”€â”€ cmd/main.go                      # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ domain/entity/              # ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”œâ”€â”€ usecase/                    # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ interface/handler/          # HTTP/WebSocketãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”œâ”€â”€ swagger/gen/                    # APIä»•æ§˜æ›¸
â”œâ”€â”€ Dockerfile                      # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸å®šç¾©
â”œâ”€â”€ docker-compose.yml             # Docker Composeè¨­å®š
â””â”€â”€ Makefile                       # ãƒ“ãƒ«ãƒ‰ãƒ»å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
```

## ğŸ² ç‰Œã®ä»•æ§˜

- **è¬å­**: 1m, 9m (å„4æš)
- **ç­’å­**: 1p-9p (5pã¯é€šå¸¸3æš+èµ¤ãƒ‰ãƒ©5pr 1æš)
- **ç´¢å­**: 1s-9s (5sã¯é€šå¸¸3æš+èµ¤ãƒ‰ãƒ©5sr 1æš)
- **å­—ç‰Œ**: ton,nan,sya,pe,haku,hatu,chun (å„4æš)
- **ç·æ•°**: 80æš

## ğŸ“Š é…ç‰Œã®ä»•æ§˜

- **è¦ªï¼ˆãƒ›ã‚¹ãƒˆï¼‰**: 14æš
- **å­ï¼ˆãã®ä»–ï¼‰**: 13æšãšã¤ (è¨ˆ26æš)
- **ç‹ç‰Œ**: 13æš (è¡¨ãƒ‰ãƒ©1æš + è£ãƒ‰ãƒ©4æš + å¶ºä¸Šç‰Œ8æš)
- **å±±ç‰Œ**: 27æš

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã‚·ãƒ³ãƒ—ãƒ«ãª3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆå®Œå…¨ãƒ¡ãƒ¢ãƒªãƒ™ãƒ¼ã‚¹ï¼‰:

```
â”œâ”€â”€ Entity    # ã‚²ãƒ¼ãƒ ãƒ»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ»ç‰Œã®å®šç¾©
â”œâ”€â”€ UseCase   # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ + ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
â””â”€â”€ Handler   # HTTP/WebSocket ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
```

**ç‰¹å¾´:**
- æ°¸ç¶šåŒ–ãªã—ï¼ˆãƒ¡ãƒ¢ãƒªã®ã¿ï¼‰
- å¤–éƒ¨ä¾å­˜ãªã—
- é«˜é€Ÿãƒ»è»½é‡ãƒ»ã‚·ãƒ³ãƒ—ãƒ«

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
